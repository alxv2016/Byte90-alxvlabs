; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:seeed_xiao_esp32s3]
platform = espressif32
board = seeed_xiao_esp32s3
framework = arduino
monitor_speed = 115200
build_flags = 
	-DCORE_DEBUG_LEVEL=5
	-DFIRMWARE_VERSION=\"2.0.0\"
board_build.filesystem = littlefs
board_build.partitions = custom_partitions.csv
lib_deps = 
	bitbank2/AnimatedGIF@2.1.1
	adafruit/Adafruit GFX Library@^1.11.11
	adafruit/Adafruit SSD1351 library@^1.3.2
	adafruit/Adafruit ADXL345@^1.3.4
	esphome/ESP32-audioI2S@^2.3.0
	adafruit/RTClib@^2.1.4
	adafruit/Adafruit DRV2605 Library@^1.2.4

; Modular Testing Configuration
[env:seeed_xiao_esp32s3_test]
platform = espressif32
board = seeed_xiao_esp32s3
framework = arduino
monitor_speed = 115200

build_flags = 
    -DCORE_DEBUG_LEVEL=5
    -DFIRMWARE_VERSION=\"2.0.0\"
    -DUNITY_DOUBLE_PRECISION=1e-12
    -DTEST_ENV

# Include all source files properly for testing
build_src_filter = 
    +<*> 
    -<main.cpp>
    +<src/*.cpp>
    +<src/**/*.cpp>
    +<lib/**/*.cpp>
    +<include/*.cpp>

lib_deps = 
    unity
    bitbank2/AnimatedGIF@2.1.1
    adafruit/Adafruit GFX Library@^1.11.11
    adafruit/Adafruit SSD1351 library@^1.3.2
    adafruit/Adafruit ADXL345@^1.3.4
    esphome/ESP32-audioI2S@^2.3.0
    adafruit/RTClib@^2.1.4
    adafruit/Adafruit DRV2605 Library@^1.2.4

# Unity test framework configuration
test_framework = unity
test_speed = 115200
test_build_src = yes

# Optional: Filter specific tests if needed
# test_filter = test_preferences*
# test_ignore = test_*stress*